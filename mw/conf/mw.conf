#Apache configuration for atlasbiowork
<VirtualHost *:443>
    ServerName soilhealthscores.com
    ServerAlias www.soilhealthscores.com
    
    
    SSLEngine On
    SSLCertificateFile /etc/letsencrypt/live/soilhealthscores.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/soilhealthscores.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf
    
    DocumentRoot /var/www/mezz/mw/
    
    #RewriteEngine On
    #RewriteCond /var/www/mezz%{REQUEST_FILENAME} !-f
    #RewriteCond /var/www/mezz/mw/media/$2 -f
    #RewriteRule ^/media/([^\/]+)/(.+) /generate/$1/$2 [PT]
	
	
	
	
    <Directory /var/www/mezz/mw/>
        AllowOverride all
        Options FollowSymLinks Multiviews 
        Require all granted
    </Directory>

    <Directory /var/www/mezz/mw/static/media/>
        AllowOverride all
        Options FollowSymLinks Multiviews 
        Require all granted
    </Directory>

    Alias /static/      /var/www/mezz/mw/static/
    Alias /mwimages/    /var/www/mezz/mw/mwimages/
    Alias /media/       /var/www/mezz/mw/static/media/
    # Uncomment the following line to use a static 'site down' front page
    # AliasMatch ^/$ /var/www/mezz/mw/static/index.html

    WSGIScriptAlias / /var/www/mezz/mw/mw/wsgi.py
    WSGIDaemonProcess soilhealthscores.com display-name=%{GROUP} python-home=/var/www/mezz/env python-path=/var/www/mezz/mw
    WSGIProcessGroup soilhealthscores.com
    WSGIApplicationGroup %{GLOBAL}

    <Directory /var/www/mezz/mw/mw>
        <Files wsgi.py>
            Require all granted
        </Files>
    </Directory>        

    # Don't cache the appcache!
    #ExpiresActive on
    #ExpiresByType text/cache-manifest "access plus 0 seconds"
    
    ErrorLog ${APACHE_LOG_DIR}/mezz-error.log
    CustomLog ${APACHE_LOG_DIR}/mezz-access.log combined
</VirtualHost>


# Redirect to SSL
<VirtualHost *:80>
    ServerName soilhealthscores.com
    ServerAlias www.soilhealthscores.com
    Redirect permanent / https://soilhealthscores.com/
    ErrorLog ${APACHE_LOG_DIR}/mezz-redir-error.log
    CustomLog ${APACHE_LOG_DIR}/mezz-redir-access.log combined
	
		
RewriteEngine on
RewriteCond %{SERVER_NAME} =www.soilhealthscores.com [OR]
RewriteCond %{SERVER_NAME} =soilhealthscores.com
RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

